<mat-card style="background-color: #ddffdd; margin: 8px; padding: 8px; display: flex; flex-direction: column;
    justify-content: center; align-items: center; align-content: center;">
    <mat-form-field appearance="outline" style="width: 300px;padding: 5px;">
        <mat-label>Competitions</mat-label>
        <mat-select (valueChange)="competitionSelected($event)">
            <mat-option [value]="">All</mat-option>
            @for (competition of competitions; track competition) {
            <mat-option [value]="competition.competition_id">{{competition.competition_name}} {{
                competition.season_name}}</mat-option>
            }
        </mat-select>
    </mat-form-field>
    @if (!!matches && matches.length > 0) {
    <mat-form-field appearance="outline" style="width: 300px;padding: 5px;">
        <mat-label>Matches</mat-label>
        <mat-select (valueChange)="matchSelected($event)">
            @for (match of matches; track match) {
            <mat-option [value]="match.id">{{match.home_team_name}} {{match.home_score}} -
                {{match.away_score}} {{match.away_team_name}}</mat-option>
            }
        </mat-select>
    </mat-form-field>
    }
</mat-card>

@if (!!event) {
<mat-tab-group style="width: 100%; height: 1000px; margin: 5px;">
    <!--
        <mat-tab label="Match Info">
            <div>
                <h2 style="margin: 0;">
                    <strong>{{competition.competition_name}}</strong> -
                    {{competition.season_name}}: {{currentMatch.home_team_name}} {{currentMatch.home_score}} -
                    {{currentMatch.away_score}} {{currentMatch.away_team_name}}
                </h2>
                <p style="margin: 4px 0;">

                </p>
                <p style="margin: 4px 0;">{{currentMatch.match_date}}</p>
                <p style="margin: 4px 0;">Referee: {{currentMatch.referee}}</p>
            </div>

        </mat-tab>-->
    <mat-tab label="Event-by-event analysis">
        <div style="
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: row;
    gap: 16px;
    font-size: 18px;
">
            <!-- Previous button -->
            <button mat-icon-button [disabled]="event_index == 0" (click)="eventChanged(-1)" style="font-size: 18px;">
                <mat-icon style="font-size: 28px;">navigate_before</mat-icon>
            </button>

            <!-- Event card -->
            <div class="event-box" *ngIf="event as e" style="
            padding: 12px 16px;
            background: #f5f5f5;
            border-radius: 8px;
            min-width: 260px;
            font-size: 18px;
            line-height: 1.3;
        ">
                <div class="event-title" style="font-weight: 600; margin-bottom: 6px; font-size: 18px;">
                    {{ e.player_name }}: {{ e.event_name }}
                </div>

                <div class="event-meta" style="color: #555; font-size: 18px;">
                    {{ e.period }}. Half â€” {{ e.timestamp.slice(3, 8) }}
                </div>
            </div>

            <!-- Next button -->
            <button mat-icon-button (click)="eventChanged(1)" style="font-size: 18px;">
                <mat-icon style="font-size: 28px;">navigate_next</mat-icon>
            </button>
        </div>

        <div style="display: flex; justify-content:center; flex-direction: row;">
            <app-football-pitch-resizable [scale]="1.8" style="padding: 10px;" [event]="event"
                [home_team]="currentMatch.home_team_name"></app-football-pitch-resizable>
        </div>
    </mat-tab>
    <mat-tab label="Player Stats">
        <div
            style="display: flex; flex-direction: row; justify-content: center; justify-items: center; align-items: center;">
            <mat-form-field style="width: 400px;" appearance="fill">
                <mat-label>Playing Style</mat-label>
                <mat-select [(ngModel)]="selectedStyle" (selectionChange)="playingStyleSelected($event)">
                    <mat-option [value]="">Any</mat-option>
                    <mat-option *ngFor="let style of set(playingStyles)" [value]="style">
                        {{ style }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <!--
        <mat-form-field appearance="fill">
            <mat-label>Players</mat-label>
            <mat-select [(ngModel)]="selectedPlayers" multiple>
                <mat-option *ngFor="let player of set(stats)" [value]="player">
                    {{player.player_name}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        -->
        <mat-table style="background-color: #bbffbb;overflow-x: auto;" [dataSource]="stats" class="mat-elevation-z8">
            <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
                <mat-header-cell *matHeaderCellDef style="min-width: 200px;"> {{ fieldDisplayMap[column] || column }}
                </mat-header-cell>
                <mat-cell *matCellDef="let element" style="min-width: 200px;"> {{ element[column] }} </mat-cell>
            </ng-container>

            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>

        </mat-table>
    </mat-tab>

    <mat-tab label="Possessions">
        <mat-form-field appearance="outline" style="width: 300px; padding: 5px;">
            <mat-label>Possessions</mat-label>
            <mat-select (valueChange)="possessionSelected($event)">
                <mat-option [value]="">All</mat-option>
                @for (poss of possessions; track poss) {
                <mat-option [value]="poss.possession">
                    {{poss.possession}}. {{poss.possession_team_name}}: {{poss.passes}} Passes
                </mat-option>
                }
            </mat-select>
        </mat-form-field>


        <div style="display: flex; width:100%;">
            <div style="padding: 10px; margin-top: 20px;">
                <div>Possession type: {{possession.playing_style}}</div>
                <app-football-pitch-resizable [possession]="possession.events"
                    [home_team]="possession.possession_team_name" [scale]="1.5">
                </app-football-pitch-resizable>
            </div>
            <app-possession-summary style="display: flex; width:100%;"
                [possession]="possession"></app-possession-summary>
        </div>
    </mat-tab>


</mat-tab-group>
}